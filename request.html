<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Request a Tutor | Home Tuition</title>
  <meta name="description"
    content="Get a free tutor quote fast. Tell us about the student, schedule and budget. We'll match you with verified private tutors." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://example.com/request.html" />
  <link rel="icon" href="/favicon.ico" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- shared stylesheet with spacing/fieldset fixes -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Request a Tutor | Home Tuition" />
  <meta property="og:description" content="Share student details and get a free, no-obligation tutor quote." />
  <meta property="og:url" content="https://example.com/request.html" />
  <meta property="og:image" content="https://example.com/og/home-tuition-request.jpg" />
  <!-- reCAPTCHA v3 -->
  <script src="https://www.google.com/recaptcha/api.js?render=6LeQU7ArAAAAAIQxgZF7u263Pox7Z7v-HqHEW6kj"></script>
  <style>

  </style>

</head>

<body>
  <a class="skip-link" href="#main">Skip to main content</a>

  <header class="site-header" aria-label="Site header">
    <nav class="nav container" aria-label="Primary">
      <a class="brand" href="index.html">
        <span class="badge" aria-hidden="true">HT</span><span>Home Tuition</span>
      </a>
      <div class="tabs" role="tablist">
        <a class="tab" role="tab" href="index.html">Home</a>
        <a class="tab" role="tab" aria-current="page" href="request.html">Request a Tutor</a>
      </div>
    </nav>
  </header>

  <section class="hero" aria-label="Hero">
    <div class="container">
      <div>
        <h1>Get a tutor near you â€” quick quote</h1>
        <p>Tell us the class, subjects and preferred timings. Weâ€™ll reply with tutor options and transparent rates.</p>
        <div class="chips" aria-label="Popular requests">
          <span class="chip">Grade 4â€“8 (All)</span>
          <span class="chip">Matric (All)</span>
          <span class="chip">F.Sc (Pre-Med)</span>
          <span class="chip">F.Sc (Pre-Eng)</span>
          <span class="chip">Thokar Niaz Baig Area</span>
        </div>
      </div>
    </div>
  </section>

  <main class="container grid" id="main">
    <!-- Form -->
    <section class="card" aria-label="Request form" id="wizard">
      <header>
        <h2 id="formTitle">Free Request for Tutor</h2>
        <div class="steps" style="width:50%" aria-hidden="true">
          <div class="step"><span id="s1"></span></div>
          <div class="step"><span id="s2"></span></div>
          <div class="step"><span id="s3"></span></div>
        </div>
      </header>

      <div class="body">
        <form id="requestForm" action="#" method="post" novalidate aria-describedby="formHelp" aria-live="polite">
          <p id="formHelp" class="hint">Fields marked * are required.</p>

          <!-- STEP 1: Who + Essentials -->
          <div class="step-pane" data-step="1">
            <fieldset>
              <legend>You are *</legend>
              <div class="radio-pills" role="radiogroup" aria-label="Who is filling this form">
                <label class="pill">
                  <input aria-label="Parent" type="radio" name="who" value="parent" checked> Parent
                </label>
                <label class="pill">
                  <input aria-label="Student" type="radio" name="who" value="student"> Student
                </label>
              </div>
            </fieldset>


            <div class="row">
              <div class="col-6 field">
                <label for="name">Your Name *</label>
                <input id="name" name="name" class="input" placeholder="Full name" required autocomplete="name" />
              </div>
              <div class="col-6 field">
                <label for="mobile">Mobile *</label>
                <input id="mobile" name="mobile" class="input" placeholder="e.g., +92 3XX XXXXXXX" required
                  autocomplete="tel" pattern="^[+0-9\\s-]{8,}$" />
              </div>
            </div>
            <div class="row">
              <div class="col-12 field">
                <label for="email">Email *</label>
                <input id="email" name="email" type="email" class="input" placeholder="you@example.com" required
                  autocomplete="email" />
              </div>
            </div>

            <div class="row">
              <div class="col-6 field">
                <label for="level">Student Level *</label>
                <select id="level" name="level" class="select" required>
                  <option value="" disabled selected>Selectâ€¦</option>
                  <option>Grade 4</option>
                  <option>Grade 5</option>
                  <option>Grade 6</option>
                  <option>Grade 7</option>
                  <option>Grade 8</option>
                  <option>Grade 9 (Matric Part I)</option>
                  <option>Grade 10 (Matric Part II)</option>
                  <option>F.Sc Part I (11th)</option>
                  <option>F.Sc Part II (12th)</option>
                </select>
              </div>
              <!-- <div class="col-6 field">
                <label for="subjects">Subjects *</label>
                <input id="subjects" name="subjects" class="input" placeholder="e.g., Math, Physics" required />
              </div> -->
              <div class="col-6 field" id="subjectPicker">
                <label>Subjects *</label>
                <div class="chip-input" aria-haspopup="listbox" aria-owns="subj-suggest" aria-expanded="false">
                  <input id="subjectsInput" class="input chip-editor" type="text" placeholder="Type to addâ€¦ e.g., Math" autocomplete="off" enterkeyhint="done" />
                  <div class="chip-bag" id="subjChips"></div>
                </div>
                <ul id="subj-suggest" class="suggestions" role="listbox" hidden></ul>
                <input id="subjects" name="subjects" type="hidden" required />
              </div>

            </div>
            <div class="row">
              <!-- <div class="col-12 field">
                <label for="location">Location *</label>
                <input id="location" name="location" class="input" placeholder="Area/City (e.g., Lahore)" required
                  autocomplete="address-level2" />
              </div> -->

              <div class="col-12 field">
                <label for="location">Location *</label>
                <input id="location" name="location" class="input" placeholder="Area/City (e.g., Thokar Niaz Baig, Lahore)" required autocomplete="address-level2" list="location-list" />
                <datalist id="location-list">
                    <option value="Thokar Niaz Baig, Lahore"></option>
                    <option value="Johar Town, Lahore"></option>
                    <option value="Model Town, Lahore"></option>
                    <option value="Wapda Town, Lahore"></option>
                    <option value="DHA, Lahore"></option>
                    <option value="Bahria Town, Lahore"></option>
                    <option value="Garden Town, Lahore"></option>
                    <option value="Faisal Town, Lahore"></option>
                    <option value="Iqbal Town, Lahore"></option>
                    <option value="Gulberg, Lahore"></option>
                </datalist>
                </div>

            </div>

            <div class="actions">
              <button class="btn" type="button" id="saveDraft1" aria-label="Save draft">Save</button>
              <div class="right">
                <button class="btn btn-primary" type="button" data-next aria-label="Next step">Next</button>
              </div>
            </div>
          </div>

          <!-- STEP 2: Schedule & Budget -->
          <div class="step-pane" data-step="2" hidden>
            <fieldset>
              <legend>Budget</legend>
              <div class="radio-pills">
                <label class="pill"><input type="radio" name="budgetType" value="market" checked> Comfortable with
                  market rates</label>
                <label class="pill"><input type="radio" name="budgetType" value="preferred"> I have a preferred
                  budget</label>
              </div>
            </fieldset>

            <div class="row">
              <!-- <div class="col-6 field" id="preferredWrap" hidden>
                <label for="rate">Preferred Hourly Rate (PKR)</label>
                <input id="rate" name="rate" class="input" placeholder="PKR 1500â€“2500/hr" inputmode="numeric" />
              </div> -->
              <div class="col-6 field" id="preferredWrap" hidden>
                <label for="rate">Preferred Hourly Rate (PKR)</label>
                <input id="rate" name="rate" class="input" placeholder="PKR 2500â€“5500/hr" inputmode="numeric" list="rate-list" />
                <datalist id="rate-list">
                    <option value="2000/hr"></option>
                    <option value="2500/hr"></option>
                    <option value="3500/hr"></option>
                    <option value="4000/hr"></option>
                    <option value="6000/hr"></option>
                    <option value="7200/hr"></option>
                    <option value="7500/hr"></option>
                </datalist>
                </div>

              <!-- <div class="col-6 field">
                <label for="start">Start Date *</label>
                <select id="start" name="start" class="select" required>
                  <option value="asap">ASAP</option>
                  <option value="date">Pick a date</option>
                </select>
              </div> -->
              <div class="col-6 field" id="dateWrap" hidden>
                <label for="date">Pick a Date</label>
                <input id="date" name="date" type="date" class="input" />
              </div>
            </div>


            <div class="row">
              <div class="col-12 field">
                <label for="times">All Available Days & Timings *</label>
                <textarea id="times" name="times" placeholder="e.g., Mon 5â€“7pm; Wed 3â€“5pm; Sat mornings"
                  required></textarea>
                <div class="hint">State as many options as possible for best matches.</div>
              </div>
            </div>

            <!-- Preferred Format removed (we only offer in-home tuition) -->

            <div class="actions">
              <button class="btn" type="button" data-prev aria-label="Previous step">Previous</button>
              <div class="right">
                <button class="btn btn-primary" type="button" data-next aria-label="Next step">Next</button>
              </div>
            </div>
          </div>

          <!-- STEP 3: Notes & Submit -->
          <div class="step-pane" data-step="3" hidden>
            <div class="row">
              <div class="col-12 field">
                <label for="needs">Notes for Matching (optional)</label>
                <textarea id="needs" name="needs"
                  placeholder="Share any learning goals, issues, tutor preferences, etc."></textarea>
              </div>
              <div class="col-12 field">
                <label for="address">Full Address of Tuition Location *</label>
                <input id="address" name="address" class="input" placeholder="Street, area, city, postal code" required
                  autocomplete="street-address" />
              </div>
              <div class="col-12 field">
                <label class="pill"><input type="checkbox" id="agree" required aria-required="true"> I agree to the
                  Terms & Conditions</label>
              </div>
            </div>
            <!-- HONEYPOT (anti-bot) â€” DO NOT REMOVE Bots usually fill every visible-looking field. We keep it hidden from users.
              Backend also ignores this key. -->
            <div class="hp" aria-hidden="true">
              <label for="website_hp">Website</label>
              <input id="website_hp" name="website_hp" type="text" tabindex="-1" autocomplete="off" inputmode="text" placeholder="Do not fill if you are human">
            </div>

            <div class="actions" style="justify-content:flex-end; gap:10px">
              <button class="btn" type="button" data-prev aria-label="Previous step">Previous</button>
              <button class="btn" type="button" id="saveDraft3" aria-label="Save draft">Save Draft</button>
              <button class="btn btn-primary" type="submit" id="submitBtn" aria-label="Submit request">Get My
                Quote</button>
            </div>
          </div>
        </form>
      </div>
    </section>

    <!-- Sidebar -->
    <aside class="aside" aria-label="Why Home Tuition">
      <div class="stat">
        <div class="hint">Step</div>
        <strong id="stepNum" aria-live="polite">1 / 3</strong>
        <div class="hint" style="margin-top:10px">Why us?</div>
        <p style="margin:8px 0 0">Fast matching, verified tutors, and flexible rates.</p>
      </div>
      <div class="faq">
        <strong>Need help?</strong>
        <p style="margin:8px 0 12px">Chat with us directly on WhatsApp.
          <br/>Available during our operating hours.
        </p>
        <!-- WhatsApp CTA: theme-matched -->
        <a id="waQuick" class="btn-wa" target="_blank" rel="noopener noreferrer" href="https://wa.me/923494486605?text=Hello%20I%20want%20to%20inquire%20about%20Home%20Tuition.">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="wa-ic" viewBox="0 0 16 16" aria-hidden="true">
            <path d="M13.601 2.326A7.85 7.85 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.9 7.9 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.9 7.9 0 0 0 13.6 2.326zM7.994 14.521a6.6 6.6 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.56 6.56 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592m3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.73.73 0 0 0-.529.247c-.182.198-.691.677-.691 1.654s.71 1.916.81 2.049c.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232"></path>
          </svg>
          Chat on WhatsApp
        </a>
      </div>
    </aside>
  </main>

  <footer>
    <small>
      Â© 2025 Home Tuition. Helping parents and students connect with trusted tutors.  
      <a href="coming-soon.html">Terms</a> Â· <a href="coming-soon.html">Privacy</a>
    </small>
  </footer>


  <script>
    // ===== Wizard State =====
    const panes = [...document.querySelectorAll('.step-pane')];
    let idx = 0;
    const s1 = document.getElementById('s1'), s2 = document.getElementById('s2'), s3 = document.getElementById('s3');
    const stepsEls = [s1, s2, s3].map(s => s.parentElement);   // .step wrappers
    const stepNum = document.getElementById('stepNum');

    function updateSteps() {
      // progress (keep your visual logic)
      s1.style.width = idx >= 0 ? '100%' : '0%';
      s2.style.width = idx >= 1 ? '100%' : '0%';
      s3.style.width = idx >= 2 ? '100%' : '0%';
      stepNum.textContent = (idx + 1) + ' / ' + panes.length;
      panes.forEach((p, i) => p.hidden = i !== idx);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    document.querySelectorAll('[data-next]').forEach(b => b.addEventListener('click', () => {
      validateCurrentStep(true);          // mark errors but allow navigation
      idx = Math.min(idx + 1, panes.length - 1);
      updateSteps();
    }));
    document.querySelectorAll('[data-prev]').forEach(b => b.addEventListener('click', () => {
      idx = Math.max(idx - 1, 0);
      updateSteps();
    }));

    // ===== Budget toggles =====
    const budgetRadios = [...document.querySelectorAll('input[name="budgetType"]')];
    const preferredWrap = document.getElementById('preferredWrap');
    budgetRadios.forEach(r => r.addEventListener('change', () => {
      preferredWrap.hidden = (document.querySelector('input[name="budgetType"]:checked').value !== "preferred");
    }));

    // ===== Integration: Submit to Apps Script with reCAPTCHA v3 =====
    const form = document.getElementById('requestForm');
    const submitBtn = document.getElementById('submitBtn');
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx_celmJAK1v0iOpqk1_R4DKvAWVvzKzLEnkQAux8xJk7WmxBnS6IDKLYd7aalEj3n5Eg/exec';
    const SITE_KEY = '6LeQU7ArAAAAAIQxgZF7u263Pox7Z7v-HqHEW6kj';

    // â€”â€”â€” toast / status banner
    const statusBar = document.createElement('div');
    statusBar.id = 'toast';
    statusBar.setAttribute('role', 'status');
    statusBar.style.cssText = 'position:fixed;left:50%;top:16px;transform:translateX(-50%);max-width:90vw;padding:10px 14px;border-radius:10px;font:500 14px/1.3 system-ui, -apple-system, Segoe UI, Roboto;box-shadow:0 8px 24px rgba(0,0,0,.12);z-index:9999;display:none';
    document.body.appendChild(statusBar);
    function showMsg(text, type = 'ok') { // ok | err
      statusBar.textContent = text;
      statusBar.style.background = type === 'ok' ? '#DCFCE7' : '#FEE2E2';
      statusBar.style.color = type === 'ok' ? '#065F46' : '#991B1B';
      statusBar.style.border = type === 'ok' ? '1px solid #86EFAC' : '1px solid #FCA5A5';
      statusBar.style.display = 'block';
      setTimeout(() => { statusBar.style.display = 'none'; }, 4000);
    }

    // â€”â€”â€” step validation helpers
    const F = (id) => document.getElementById(id);
    const fieldsByStep = [
      // step 1
      [F('name'), F('mobile'), F('email'), F('level'), F('subjects'), F('location')],
      // step 2
      [F('times')], // dynamic: rate only if preferred
      // step 3
      [F('address'), F('agree')]
    ];

    function markField(el, valid, msg) {
      const wrap = el.closest('.field') || el.parentElement;
      if (valid) {
        wrap?.classList.remove('invalid');
        const err = wrap?.querySelector('.err'); if (err) err.remove();
        el.removeAttribute('aria-invalid');
      } else {
        wrap?.classList.add('invalid');
        el.setAttribute('aria-invalid', 'true');
        if (wrap && !wrap.querySelector('.err')) {
          const small = document.createElement('small');
          small.className = 'err';
          small.textContent = msg || 'This field is required';
          wrap.appendChild(small);
        }
      }
    }

    function validateStep(stepIndex) {
      const missing = [];
      const els = [...fieldsByStep[stepIndex]];
      // dynamic rules
      if (stepIndex === 1) {
        const pref = document.querySelector('input[name="budgetType"]:checked')?.value === 'preferred';
        if (pref) els.push(F('rate'));
      }
      els.forEach(el => {
        if (!el) return;
        let ok = true;
        if (el.type === 'checkbox') ok = el.checked;
        else ok = !!String(el.value || '').trim();
        markField(el, ok);
        if (!ok) missing.push(el);
      });
      return missing;
    }

    function validateCurrentStep(markOnly = false) {
      const missing = validateStep(idx);
      // flag step header
      stepsEls[idx].classList.toggle('error', missing.length > 0);
      if (missing.length > 0 && markOnly) {
        showMsg(`Step ${idx + 1}: ${missing.length} required field(s) missing.`, 'err');
      }
      return missing.length === 0;
    }

    function validateAll() {
      let firstBad = -1, totalMissing = 0;
      stepsEls.forEach((_, i) => {
        const miss = validateStep(i);
        stepsEls[i].classList.toggle('error', miss.length > 0);
        if (miss.length > 0 && firstBad === -1) firstBad = i;
        totalMissing += miss.length;
      });
      return { ok: totalMissing === 0, firstBad };
    }

    // â€”â€”â€” map backend error â†’ friendly text
    function friendlyError(raw = '') {
      const t = String(raw || '').toLowerCase();
      if (t.includes('missing_recaptcha_secret')) return 'Server config missing. Please try again shortly.';
      if (t.includes('recaptcha_secret') || t.includes('script property')) return 'Server not fully configured. Please try again shortly.';
      if (t.includes('recaptcha_failed')) return 'Bot check failed. Refresh and try again.';
      if (t.includes('missing_recaptcha_token')) return 'Couldnâ€™t verify token. Refresh and try again.';
      if (t.includes('origin_not_allowed')) return 'This domain is not allowed to submit the form.';
      if (t.includes('low_score')) return 'Submission looked automated. Please try again.';
      if (t.includes('quota') || t.includes('limit')) return 'Email quota reached. Please try again later.';
      return raw || 'Something went wrong. Please try again.';
    }

    // â€”â€”â€” submit handler
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      // hard validation across all steps
      const v = validateAll();
      if (!v.ok) {
        idx = v.firstBad >= 0 ? v.firstBad : 0;
        updateSteps();
        showMsg('Please fill the required fields before submitting.', 'err');
        return;
      }

      // Honeypot
      if (form.website_hp && form.website_hp.value) { showMsg('Blocked (bot suspected).', 'err'); return; }

      // UI lock
      submitBtn.disabled = true; submitBtn.textContent = 'Submittingâ€¦';

      grecaptcha.ready(function () {
        grecaptcha.execute(SITE_KEY, { action: 'submit' }).then(async function (token) {
          const fd = new FormData(form);
          fd.append('token', token);

          const summary = [
            'Who: ' + (form.who.value || ''),
            'Level: ' + (form.level.value || ''),
            'Subjects: ' + (form.subjects.value || ''),
            'Location: ' + (form.location.value || ''),
            'Budget: ' + (form.budgetType.value || '') + (form.rate?.value ? (' (' + form.rate.value + ')') : ''),
            'Times: ' + (form.times.value || '')
          ].join(' | ');
          fd.append('summary', summary);

          try {
            const res = await fetch(SCRIPT_URL, { method: 'POST', body: fd });
            const text = await res.text();
            let ok = false, err = '';
            try { const j = JSON.parse(text); ok = !!j.ok; err = j.error || ''; }
            catch { ok = /{"ok":\s*true}/i.test(text) || /ok/i.test(text); }

            if (!ok) {
              showMsg(friendlyError(err), 'err');
            } else {
              showMsg('Thanks! Weâ€™ll WhatsApp/Email you a quote shortly.', 'ok');
              form.reset(); stepsEls.forEach(s => s.classList.remove('error'));
              idx = 0; updateSteps();
            }
          } catch (e) {
            showMsg('Network error. Please check your connection and try again.', 'err');
          } finally {
            submitBtn.disabled = false; submitBtn.textContent = 'Get My Quote';
          }
        });
      });
    });

    // init
    updateSteps();

    // ===== Local Storage: Save & Load Draft =====
    const STORAGE_KEY = "tutorRequestDraft";

    // helper: form â†’ object
    function getFormData() {
      const data = {};
      new FormData(form).forEach((v, k) => data[k] = v);
      return data;
    }

    // helper: object â†’ form fill
    function setFormData(data) {
      Object.keys(data || {}).forEach(k => {
        const el = form.elements[k];
        if (!el) return;
        if (el.type === "radio") {
          const radio = form.querySelector(`input[name="${k}"][value="${data[k]}"]`);
          if (radio) radio.checked = true;
        } else if (el.type === "checkbox") {
          el.checked = data[k] === "on" || data[k] === true;
        } else {
          el.value = data[k];
        }
      });
    }

    // save draft function
    function saveDraft() {
      const data = getFormData();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      showMsg("Draft saved locally. You can continue later.", "ok");
    }

    // attach to Save buttons
    document.getElementById("saveDraft1")?.addEventListener("click", saveDraft);
    document.getElementById("saveDraft3")?.addEventListener("click", saveDraft);

    // auto-fill on load if draft exists
    window.addEventListener("DOMContentLoaded", () => {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        try {
          const data = JSON.parse(raw);
          setFormData(data);
          showMsg("Draft data loaded from previous session.", "ok");
        } catch {}
      }
    });

    // Whatsapp Quick Message Link with Prefilled Details
    document.addEventListener('DOMContentLoaded', () => {
        const WA_NUMBER = '923494486605'; // your real WhatsApp number (digits only)

        const waBtn = document.getElementById('waQuick');
        if (!waBtn) return;

        const form = document.getElementById('requestForm');

        const val = (el, ph) => {
        if (!el) return ph;
        const v = (typeof el === 'string') ? el : (el.value || '');
        return v.trim() || ph;
        };

        function buildMessage() {
        const name     = form?.name;
        const level    = form?.level;
        const subjects = form?.subjects;
        const location = form?.location;
        const times    = form?.times;
        const mobile   = form?.mobile;
        const email    = form?.email;
        const age      = form?.age;
        const school   = form?.school;

        return [
            `*ðŸ« Home Tuition Inquiry â€” Thokar Niaz Baig*`,
            ``,
            `*My name:* ${val(name, 'Type your name')}`,
            `*Student level / class:* ${val(level, 'e.g., Grade 8 / O-Levels')}`,
            `*Subjects:* ${val(subjects, 'e.g., Math, Science')}`,
            `*Location:* ${val(location, 'Area/Street name')}`,
            `*Age:* ${val(age, 'Age (optional)')}`,
            `*School:* ${val(school, 'School name (optional)')}`,
        ].join("\n");
        }


        function makeUrl() {
        const msg = encodeURIComponent(buildMessage());
        return `https://wa.me/${WA_NUMBER}?text=${msg}`;
        }

        if (form) waBtn.href = makeUrl();

        waBtn.addEventListener('click', (e) => {
        const url = makeUrl();
        waBtn.href = url;
        window.open(url, '_blank', 'noopener');
        e.preventDefault();
        });

        if (form) {
        ['name','level','subjects','location','times','mobile','email','age','school']
            .forEach(id => form[id]?.addEventListener('input', () => {
            waBtn.href = makeUrl();
            }));
        }
    });
    // Whatsapp Quick Message Link with Prefilled Details - END

  </script>



<script>
(() => {
  const SUGGESTIONS = [
    "Math","Science","Biology","Chemistry","Physics",
    "English","Urdu","Computer","Islamiyat","Pak Studies",
    "General Knowledge"
  ];

  const root   = document.getElementById('subjectPicker');
  if (!root) return;

  const editor = root.querySelector('#subjectsInput');
  const bag    = root.querySelector('#subjChips');
  const hidden = root.querySelector('#subjects');
  const list   = root.querySelector('#subj-suggest');
  const form   = root.closest('form');

  let picked = [];
  const maxChips = 10;

  const norm = s => s.trim().replace(/\s+/g, ' ');
  const syncHidden = () => hidden.value = picked.join(', ');

  // ------- RENDER (single, clean) -------
  function renderChips() {
    bag.innerHTML = picked.map((label, i) => `
      <button type="button" class="chip chip--soft chip-rem" data-i="${i}" title="Remove">
        <span class="chip-text">${label}</span>
        <span class="chip-x" aria-hidden="true">&times;</span>
      </button>
    `).join('');
    syncHidden();
  }

  // one listener for all chips (click or keyboard)
  bag.addEventListener('click', (e) => {
    const btn = e.target.closest('.chip-rem');
    if (!btn) return;
    const i = Number(btn.dataset.i);
    if (!Number.isNaN(i)) {
      picked.splice(i, 1);
      renderChips();
      // refresh suggestions so removed items can appear again
      showSuggestions(editor.value);
      editor.focus();
    }
  });
  bag.addEventListener('keydown', (e) => {
    if (!e.target.classList.contains('chip-rem')) return;
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      e.target.click();
    }
  });

  function addChip(value) {
    value = norm(value);
    if (!value) return;
    if (picked.includes(value)) return;
    if (picked.length >= maxChips) return;
    picked.push(value);
    renderChips();
  }

  function showSuggestions(query='') {
    const q = norm(query).toLowerCase();
    const items = SUGGESTIONS
      .filter(s => !picked.includes(s))
      .filter(s => !q || s.toLowerCase().includes(q))
      .slice(0, 8);

    list.innerHTML = '';
    items.forEach((s, idx) => {
      const li = document.createElement('li');
      li.role = 'option';
      li.tabIndex = -1;
      li.textContent = s;
      li.addEventListener('mousedown', (e) => { // before blur
        e.preventDefault(); addChip(s); editor.value=''; hideSuggestions();
      });
      list.appendChild(li);
      if (idx === 0) li.classList.add('is-active');
    });

    if (items.length) {
      list.hidden = false;
      root.querySelector('.chip-input').setAttribute('aria-expanded','true');
    } else hideSuggestions();
  }
  function hideSuggestions(){
    list.hidden = true;
    root.querySelector('.chip-input').setAttribute('aria-expanded','false');
  }

  // one place that commits what's currently typed
  function commitFromEditor() {
    const active = list.querySelector('.is-active');
    if (!list.hidden && active) {
      addChip(active.textContent);
      editor.value = '';
      hideSuggestions();
      return true;
    }
    const v = norm(editor.value);
    if (v) {
      addChip(v);
      editor.value = '';
      hideSuggestions();
      return true;
    }
    return false;
  }

  // Keyboard + mobile safety nets
  editor.addEventListener('keydown', (e) => {
    if (['Enter','Tab'].includes(e.key) || e.key === ',') {
      if (commitFromEditor() && e.key !== 'Tab') e.preventDefault();
    }
    if (e.key === 'Backspace' && !editor.value && picked.length) {
      picked.pop(); renderChips(); e.preventDefault();
    }
    if (!list.hidden && (e.key === 'ArrowDown' || e.key === 'ArrowUp')) {
      const items = [...list.children];
      let i = items.findIndex(li => li.classList.contains('is-active'));
      i = (e.key === 'ArrowDown') ? (i+1) % items.length : (i-1+items.length)%items.length;
      items.forEach(li => li.classList.remove('is-active'));
      items[i].classList.add('is-active');
      e.preventDefault();
    }
    if (e.key === 'Escape') hideSuggestions();
  });
  editor.addEventListener('keyup', (e) => {
    if (e.key === 'Enter') { if (commitFromEditor()) e.preventDefault(); }
  });
  // ðŸ‘‡ NEW: on blur just hide (no commit)
  editor.addEventListener('blur', () => {
    setTimeout(hideSuggestions, 0);
  });

  // change â†’ still allowed to commit if a value typed and no key events fired
  editor.addEventListener('change', () => commitFromEditor());
  // input â†’ filter suggestions live
  editor.addEventListener('input', () => showSuggestions(editor.value));
  // ðŸ‘‡ Tweak focus behavior (pick ONE)
  editor.addEventListener('focus', () => {
    if (editor.value.trim()) showSuggestions(editor.value); // only if has text
    // OR: showSuggestions(editor.value); // if you want on blank focus too
  });
  // ðŸ‘‡ NEW: click/tap outside â†’ hide
  document.addEventListener('pointerdown', (e) => {
    if (!root.contains(e.target)) hideSuggestions();
  });
  if (form) {
    form.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && document.activeElement === editor) {
        if (commitFromEditor()) e.preventDefault();
      }
    }, true);
    form.addEventListener('submit', () => { commitFromEditor(); });
  }

  // initial render (empty)
  renderChips();
})();
</script>


</body>

</html>